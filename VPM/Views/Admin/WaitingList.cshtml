@{ Layout = "_Layout";}

@{ Layout = "_Layout";}
@using PagedList.Core;
@using PagedList;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, PagedList.Core.Mvc

@{ var wl = (IPagedList<VPM.Models.WaitingList>)ViewBag.wl;}

@*jalerts*@
<link href="~/assets/libs/jquery_alerts/jquery-confirm.min.css" rel="stylesheet" />
<script src="~/assets/libs/jquery_alerts/jquery-confirm.min.js"></script>


@*tree view*@
<link href="~/assets/libs/treeView/treeView.css" rel="stylesheet" />
<script src="~/assets/libs/treeView/treeView.js"></script>

@if (wl.Count() > 0)
{
    <h3>Waiting List</h3>
}
@if (wl.Count() > 0)
{
    <div class="row">
        <div class="col-md-12">
            <pager class="pager-container"
                   list="@wl"
                   options="@PagedList.Core.Mvc.PagedListRenderOptions.PageNumbersOnly"
                   asp-action="WaitingList"
                   asp-controller="Admin"
                   asp-route-keyword="" />

            <table class="table table-striped tblsm" style="width:100%;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Surname</th>
                        <th>Details</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var i in wl)
                    {
                        <tr>
                            <td>@i.date.ToString("yyyy-MM-dd")</td>
                            <td>@i.name</td>
                            <td>@i.surname</td>
                            <td>



                                @*tree view for the rest of the contact details*@
                                <ul class="tree1">
                                    <li>
                                        <a href="javascript:void(0);"> @i.mobile </a>
                                        <ul>
                                            <li> Email: @i.email </li>
                                            <li> Address: @i.address </li>
                                            <li> From: @i.fromDate.ToString("yyyy-MM-dd") To @i.toDate.ToString("yyyy-MM-dd") </li>
                                            <li>
                                                Stage
                                                <div class="progress">
                                                    <div class="progress-bar progress-bar-striped active" role="progressbar"
                                                         aria-valuenow="@i.getStage()" aria-valuemin="0" aria-valuemax="100" style="width:@i.getStage()%">
                                                        @i.getStage()%
                                                    </div>
                                                </div>


                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                                @*end tree view for the details*@

                            </td>
                            <td>
                                <i class="fa fa-trash trashIcon" title="Remove From Waiting List" onclick="removeFromWaitingList('@i._id')" style="font-size:13px;cursor:pointer;"></i>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>


            <pager class="pager-container"
                   list="@wl"
                   options="@PagedList.Core.Mvc.PagedListRenderOptions.PageNumbersOnly"
                   asp-action="WaitingList"
                   asp-controller="Admin"
                   asp-route-keyword="" />
        </div>

    </div>
}
else
{
    <p><center><h4>Waiting List is Empty</h4></center></p>

}

<script>
    function removeFromWaitingList(wid) {
        $.confirm({

            content: "Remove From Waiting List",
            title: "",
            type:"orange",
            buttons: {
                yes: function () {
                    removeFromWaitingList_(wid)
                },
                no: function () { },
            }

        });

    }

    function removeFromWaitingList_(wid) {
        $.ajax({
            url: "/Admin/removeFromWaitingList",
            data: { wid: wid, pid:"@ViewBag.pid"},
            success: function (res) {
                console.log(res);
                if (res.res == "ok") {
                    window.location = "";
                }
                else {
                    alert("Server Error");
                }

            },
            error: function () {
                alert("Error");
            }

        });


    }

</script>