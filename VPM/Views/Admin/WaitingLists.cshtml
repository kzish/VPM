@{Layout = "_Layout";}

@{var properties = (IPagedList<VPM.Models.mProperty>)ViewBag.properties;}

@using PagedList.Core;
@using PagedList;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, PagedList.Core.Mvc




@*tree view*@
<link href="~/assets/libs/treeView/treeView.css" rel="stylesheet" />
<script src="~/assets/libs/treeView/treeView.js"></script>

<div class="container">
    <div class="row">
        <div class="col-m-12">
            <form class="form-inline" action="/Admin/WaitingLists" method="post" style="width:100%;">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" name="param" placeholder="search name,email,address" value="@ViewBag.param" />
                    <div class="input-group-append">
                        <span> <input type="submit" class="btn btn-primary" value="search" /></span>
                    </div>
                </div>
            </form>
        </div>
    </div>

    @foreach (var i in properties)
    {
        <div class="row">
            <div class="col-md-12">
                <h4 class="card-title">@i.propertyName Number of Occupants(@i.getNumOccupants()) <a href="/Admin/ViewProperty?pid=@i._id">View Property</a></h4>
                
                <table class="table table-striped mytable tblsm" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Name</th>
                            <th>Surname</th>
                            <th>Mobile</th>
                            <th>Email</th>
                            <th>Address</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var j in i.waitingList.OrderBy(x => x.date))
                        {
                            <tr style="@(j.isAssigned?"background:green;color:white;":"")">
                                <td title="@j.date.ToString("d MMM yyyy")">@j.date.ToString("d MMM yyyy")</td>
                                <td title="@j.name">@j.name</td>
                                <td title="@j.surname">@j.surname</td>
                                <td title="@j.mobile">@j.mobile</td>
                                <td title="@j.email">@j.email</td>
                                <td title="@j.address">@j.address</td>
                                <td style="cursor:pointer;">
                                    <b title="Remove From Waiting List" onclick="removeFromWaitingList('@i._id','@j._id');">Remove | </b>
                                    <b title="View Eligibility Form" onclick="reviewEligibility('@i._id','@j._id');">Review | </b>
                                    <b title="Assign to Property" onclick="assignClientToProperty('@i._id','@j._id');">Assign |</b>
                                    @if (j.isAssigned)
                                    {
                                        <b title="Assign to Property" onclick="deAssignClientToProperty('@i._id','@j._id');">de-Assign</b>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }

    @*pager indicator*@
    <pager class="pager-container"
           list="@properties"
           options="@PagedList.Core.Mvc.PagedListRenderOptions.PageNumbersOnly"
           asp-action="WaitingLists"
           asp-controller="Admin"
           asp-route-keyword="" />
</div>@*container*@


<script>
    function removeFromWaitingList(pid, cid) {
        $.confirm({
            title: "Confirmation",
            content: "Remove from waiting List?",
            type: "orange",
            buttons: {
                "Remove": function () {
                    window.location = "/Admin/removeFromWaitingList2?cid=" + cid + "&pid=" + pid
                },
                "Cancel": function () { }
            }

        });

    }

    function assignClientToProperty(pid, cid) {

        $.confirm({
            title: "Confirmation",
            content: "Assign to property?",
            type: "orange",
            buttons: {
                "Assign": function () {
                    window.location = "/Admin/assignClientToProperty?cid=" + cid + "&pid=" + pid
                },
                "Cancel": function () { }
            }

        });
    }

    function deAssignClientToProperty(pid, cid) {

        $.confirm({
            title: "Confirmation",
            content: "de-Assign to property?",
            type: "orange",
            buttons: {
                "de-Assign": function () {
                    window.location = "/Admin/deAssignClientToProperty?cid=" + cid + "&pid=" + pid
                },
                "Cancel": function () { }
            }

        });
    }

</script>